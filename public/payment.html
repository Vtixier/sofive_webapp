<!DOCTYPE html>
<html>

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Sofive Soccer Center</title>

    <link href="css/plugins/select2/select2.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/switchery/0.8.2/switchery.min.css" rel="stylesheet">

    <link href="css/plugins/datapicker/datepicker3.css" rel="stylesheet">

    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="font-awesome/css/font-awesome.css" rel="stylesheet">
    <link href="css/animate.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
    <link rel="icon" href="https://sofive.com/wp-content/uploads/2018/04/cropped-sigle-32x32.png" sizes="32x32" />
    <link rel="icon" href="https://sofive.com/wp-content/uploads/2018/04/cropped-sigle-192x192.png" sizes="192x192" />
    <!-- Toastr style -->
    <link href="css/plugins/toastr/toastr.min.css" rel="stylesheet">
</head>

<body class="fixed-sidebar">

    <div id="wrapper">

        <div>
            <sofive-left-menu />
        </div>

        <div id="page-wrapper" class="gray-bg">

            <div>
                <sofive-header />
            </div>

            <div class="row wrapper border-bottom white-bg page-heading">
                <div class="col-lg-10">
                    <h2>Book a field</h2>
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item">
                            <a href="book_a_field.html">Selection</a>
                        </li>
                        <li class="breadcrumb-item">
                            <a href="confirmation.html">Confirmation</a>
                        </li>
                        <li class="breadcrumb-item active">
                            <strong>Paiement</strong>
                        </li>
                    </ol>
                </div>
                <div class="col-lg-2">
                </div>
            </div>

            <div class="wrapper wrapper-content animated fadeInRight" style="padding-bottom: 5px">

                <div class="row">
                    <div class="col-md-10">
                        <h2>Summary</h2>
                        <strong>Product:</strong>: Name of product <br />
                        <strong>Price:</strong>: <span class="text-navy">$452.90</span>

                        <p class="m-t">
                            Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do
                            eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut
                            enim ad minim veniam, quis nostrud exercitation ullamco laboris
                            nisi ut aliquip ex ea commodo consequat.

                        </p>

                        <form action="http://localhost:8080/event/charge" method="post" class="payment">

                            <input type="hidden" name="amount" value="500" />

                            <script src="js/checkout.js" class="stripe-button" data-key="pk_test_POTzqQ3H0tD01tMZjPsijfhK" data-description="Book a field" data-amount="500" data-locale="auto"></script>
                        </form>

                    </div>

                </div>

            </div>










            <sofive-footer />
        </div>

    </div>

    <!-- Mainly scripts -->
    <script src="js/jquery-3.1.1.min.js"></script>
    <script src="js/popper.min.js"></script>
    <script src="js/bootstrap.js"></script>
    <script src="js/plugins/metisMenu/jquery.metisMenu.js"></script>
    <script src="js/plugins/slimscroll/jquery.slimscroll.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/switchery/0.8.2/switchery.min.js"></script>

    <!-- Custom and plugin javascript -->
    <script src="js/inspinia.js"></script>

    <script src="js/plugins/select2/select2.full.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/vue"></script>

    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/vue-resource/1.5.1/vue-resource.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>
    <script src="js/plugins/datapicker/bootstrap-datepicker.js"></script>
    <script type="text/javascript" src="js/he.js"></script>

    <script type="text/javascript" src="js/navigation.js"></script>
    <script type="text/javascript" src="js/header.js"></script>
    <script type="text/javascript" src="js/footer.js"></script>

    <script type="text/javascript">
        var app = new Vue({
            el: '#wrapper',
            data: {
                date: "",
                centers: [],
                facility_loading: false,
                recordings: [],
                times: ["12 am", "7 am", "8 am", "9 am", "10 am", "11 am", "12 pm", "1 pm", "2 pm", "3 pm", "4 pm", "5 pm", "6 pm", "7 pm", "8 pm", "9 pm", "10 pm", "11 pm"],
                selected: {
                    time: "0",
                    center: "0",
                    field: "0",
                    league: "0",
                    level: "0"
                },
                loaded: 0,
                loading: false,
            },
            computed: {
                fields: function() {
                    return [...new Set(this.recordings.map((rec) => (rec.field)))].sort()
                },
                leagues: function() {
                    let l = []
                    this.recordings.forEach((rec) => {
                        if (rec.parsed_date.format("MM-DD-YYYY") === this.date) {
                            rec.matches.forEach((match) => {
                                l.push(match.event)
                            })
                        }
                    })
                    return [...new Set(l)].sort().map((e) => {
                        return {
                            value: e,
                            display: he.decode(e)
                        }
                    })
                },
                levels: function() {
                    let l = []
                    this.recordings.forEach((rec) => {
                        if (rec.parsed_date.format("MM-DD-YYYY") === this.date) {
                            rec.matches.forEach((match) => {
                                l.push(match.level || "Not specified")
                            })
                        }
                    })
                    return [...new Set(l)].sort().map((e) => {
                        return {
                            value: e,
                            display: he.decode(e)
                        }
                    })
                },
                filtered_recordings: function() {
                    let recs = [...this.recordings]
                    if (this.selected.center !== "0") {
                        recs = recs.filter((rec) => (rec.center === this.selected.center))
                    }
                    if (this.selected.field !== "0") {
                        recs = recs.filter((rec) => (rec.field === this.selected.field))
                    }
                    if (this.selected.league !== "0") {
                        recs = recs.filter((rec) => {
                            let ok = false
                            for (let i = 0; i < rec.matches.length; i++) {
                                if (rec.matches[i].event == this.selected.league) {
                                    ok = true
                                    break
                                }
                            }
                            return ok
                        })
                    }
                    if (this.selected.level !== "0") {
                        recs = recs.filter((rec) => {
                            let ok = false
                            for (let i = 0; i < rec.matches.length; i++) {
                                if (rec.matches[i].level && (rec.matches[i].level == this.selected.level)) {
                                    ok = true
                                    break
                                }
                            }
                            return ok
                        })
                    }
                    if (this.date !== "") {
                        recs = recs.filter((rec) => (rec.parsed_date.format("MM-DD-YYYY") === this.date))
                    }
                    if (this.selected.time !== "0") {
                        const now = moment(this.date + " " + this.selected.time, "MM-DD-YYYY h a")
                        recs = recs.filter((rec) => {
                            return rec.parsed_date.diff(now, 'seconds') >= 0
                        })
                    }
                    return recs
                }
            },
            mounted: function() {
                const self = this;
                this.date = moment().subtract(1, "d").format("MM-DD-YYYY")
                this.resetLoaded()
                this.getCenters()
                $('.input-group.date').datepicker({
                    todayBtn: "linked",
                    keyboardNavigation: false,
                    forceParse: false,
                    calendarWeeks: true,
                    autoclose: true
                }).on('changeDate', function(e) {
                    self.date = moment(e.date).format("MM-DD-YYYY")
                    self.resetLoaded()
                });
            },
            methods: {
                getCenters: function() {
                    // this.facility_loading = true
                    this.centers = []
                    this.$http.get("http://localhost:8080/facility/")
                        .then((resp) => {
                            this.centers = resp.body;
                            this.facility_loading = false
                        })
                        .catch((err) => {
                            console.log(err.body.errors)
                        })
                },
                getRecordings: function() {
                    this.$http.get('https://app.scoreplay.io/recordings?date=' + this.date)
                        .then((resp) => {
                            let clips = 0
                            this.recordings = resp.data.map((rec) => {
                                const moment_date = moment(rec.date, "MM-DD-YYYY h:mma")
                                return {
                                    ...rec,
                                    embed: "https://www.dailymotion.com/embed/video/" + rec.id + "?queue-enable=false&queue-autoplay-next=false&ui-start-screen-info=false",
                                    parsed_date: moment_date,
                                    start_date: moment_date.format("h") + ":00" + moment_date.format("a"),
                                    full_date: moment_date.format("MM-DD-YYYY h") + ":00" + moment_date.format("a"),
                                    matches: rec.matches.map((match) => {
                                        const m_date = moment(match.date, "YYYY-MM-DD HH:mm:ss")
                                        return {
                                            time: m_date.format("h:mma"),
                                            event: match.event,
                                            home: match.home.teamName,
                                            away: match.away.teamName,
                                            parsed_date: m_date,
                                            id: match.matchID
                                        }
                                    }).sort(this.dateSortFunc)
                                }
                            }).sort(this.dateSortFunc)
                        })
                        .catch((err) => {
                            console.log(err)
                        })
                },
                resetLoaded: function() {
                    this.loaded = 0
                    this.loading = true
                    this.getRecordings()
                },
                onMyFrameLoad: function() {
                    this.loaded += 1
                    if (this.loaded >= Math.min(this.filtered_recordings.length, 20)) {
                        console.log("ALL loaded")
                        this.loading = false
                    }
                },
                dateSortFunc: function(a, b) {
                    const diff = b.parsed_date.diff(a.parsed_date, 'seconds')
                    if (diff > 0) {
                        return -1
                    } else if (diff < 0) {
                        return 1
                    } else {
                        return 0
                    }
                },
                gotoMatch: function(match_id) {
                    window.location = "match.html?id=" + match_id
                }
            }
        })
    </script>

</body>

</html>