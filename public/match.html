<!DOCTYPE html>
<html>

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Sofive Soccer Center</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <link rel="apple-touch-icon" href="https://sofive.com/wp-content/uploads/2018/04/cropped-sigle-192x192.png" />
    <link rel="apple-touch-icon" sizes="72x72" href="https://sofive.com/wp-content/uploads/2018/04/cropped-sigle-192x192.png" />
    <link rel="apple-touch-icon" sizes="114x114" href="https://sofive.com/wp-content/uploads/2018/04/cropped-sigle-192x192.png" />
    <meta name="apple-mobile-web-app-title" content="Sofive">
    <style type="text/css">
        body {
            -webkit-user-select: none;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
        }
    </style>

    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="font-awesome/css/font-awesome.css" rel="stylesheet">
    <link href="css/animate.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
    <link rel="icon" href="https://sofive.com/wp-content/uploads/2018/04/cropped-sigle-32x32.png" sizes="32x32" />
    <link rel="icon" href="https://sofive.com/wp-content/uploads/2018/04/cropped-sigle-192x192.png" sizes="192x192" />

    <style type="text/css">
        .float-left {
            float: left;
            color: #295182
        }

        .float-right {
            float: right;
            color: #75acda
        }
    </style>

</head>

<body class="fixed-sidebar">

    <div id="wrapper">

        <div>
            <sofive-left-menu />
        </div>

        <div id="page-wrapper" class="gray-bg">


            <div>
                <sofive-header />
            </div>


            <div class="wrapper wrapper-content animated fadeInRight">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="ibox ">
                            <div class="ibox-content text-center p-md" style="background-color: rgba(232, 232, 232, 0.43); border: 1px solid #e6eaec;">
                                <div class="row">
                                    <div class="col-sm">
                                        <a style="font-size: 50px" class="text-center"><strong> <span style="color: #295182" v-on:click="gotoTeam(match.home.team_id)"> {{match.home.name}}</span> <span style="color: #4c4949" v-if="match.home.score>=0"> {{match.home.score}}</span> - <span style="color: #4c4949" v-if="match.away.score>=0">{{match.away.score}}</span> </span> <span style="color: #75acda" v-on:click="gotoTeam(match.away.team_id)"> {{match.away.name}} </strong></a>
                                        <h3 style="margin: 8px; cursor: pointer;" v-on:click="gotoLeague(league.id)"><b>{{league.name}}</b></h3>
                                        <h3>{{season.name}}</h3>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row animated fadeInRight">
                    <div class="col-lg-4">
                        <div class="ibox ">
                            <div class="ibox-title">
                                <h5>Replay</h5>
                            </div>
                            <div>
                                <div class="ibox-content no-padding border-left-right">
                                    <figure v-for="video in videos" style="margin: 0">
                                        <iframe class="video" allow="autoplay" :src="video.embed" frameborder="0" allowfullscreen></iframe>
                                    </figure>
                                </div>
                                <div class="ibox-content profile-content">
                                    <h4><strong>{{match.home.name}} <span v-if="match.home.score>=0">{{match.home.score}}</span> - <span v-if="match.away.score>=0">{{match.away.score}}</span> {{match.away.name}}</strong></h4>
                                    <p />
                                    <p><i class="fa fa-map-marker"></i> {{facility.name}}</p>
                                    <p><i class="fa fa-male"></i> {{referee.firstname+" "+referee.lastname}}</p>
                                    <div class="user-button">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <button type="button" class="btn btn-primary btn-sm btn-block" style="background-color: #4267b2; border-color: #4267b2"><i class="fa fa-facebook-square"></i> Share on Facebook</button>
                                            </div>
                                            <div class="col-md-6">
                                                <button type="button" class="btn btn-default btn-sm btn-block"><i class="fa fa-pencil"></i> Referee assessment</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <br />
                                <sofive-standings :standings="leaderboard" :team="match.home.name" :opponent="match.away.name" />
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-8">
                        <div class="ibox ">
                            <div class="ibox-title">
                                <h5>Live</h5>
                                <div class="ibox-tools">
                                    <a class="collapse-link">
                                        <i class="fa fa-chevron-up"></i>
                                    </a>
                                    <a class="close-link">
                                        <i class="fa fa-times"></i>
                                    </a>
                                </div>
                            </div>
                            <div class="ibox-content" style="height: 76vh; overflow: scroll;">
                                <h2 v-if="events.length === 0">No events recorded for this match</h2>
                                <div class="scroll_content" v-if="events.length">

                                    <div id="vertical-timeline" class="vertical-container dark-timeline center-orientation">

                                        <div class="vertical-timeline-block" v-for="event in events" style="margin: 25px">
                                            <div class="vertical-timeline-icon navy-bg">
                                                <i class="fa fa-soccer-ball-o" v-if="event.type == 'goal'"></i>
                                                <i class="fa fa-meh-o" v-if="event.type == 'foul'"></i>
                                                <img src="img/sofive/yellow_card.ico" style="margin-top: 10%" v-if="event.type == 'yellow_card'" />
                                                <img src="img/sofive/red_card.ico" style="margin-top: 10%" v-if="event.type == 'red_card'" />
                                            </div>

                                            <div :class="{'vertical-timeline-content': true,
                                            'float-right': (match.home.name !== event.side),
                                            'float-left': (match.home.name === event.side)}" style="padding: 10px">
                                                <!-- <a href="#" class="btn btn-sm btn-primary">Video</a> -->
                                                <h2>{{event.date}} <b>{{event.type}}</b> from <b>{{event.side}}</b></h2>
                                                <div v-html="event.subtitle"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div><br />
                        <div class="ibox">
                            <div class="ibox-title">
                                <h5>Rosters</h5>
                                <div class="ibox-tools">
                                    <a class="collapse-link">
                                        <i class="fa fa-chevron-up"></i>
                                    </a>
                                    <a class="close-link">
                                        <i class="fa fa-times"></i>
                                    </a>
                                </div>
                            </div>
                            <div class="ibox-content">

                                <div class="row">
                                    <div class="col-lg-6">
                                        <table class="table table-hover margin bottom">
                                            <thead>
                                                <tr>
                                                    <th style="width: 1%" class="text-center">No.</th>
                                                    <th>Players</th>
                                                    <th class="text-center">Goals</th>
                                                </tr>
                                            </thead>
                                            <tbody v-if="home_team">
                                                <tr v-for="(player, index) in home_team.roster">
                                                    <td class="text-center">{{index+1}}</td>
                                                    <td> {{player.name}}
                                                    </td>
                                                    <td class="text-center small">0</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <div class="col-lg-6">
                                        <table class="table table-hover margin bottom">
                                            <thead>
                                                <tr>
                                                    <th style="width: 1%" class="text-center">No.</th>
                                                    <th>Player</th>
                                                    <th class="text-center">Goals</th>
                                                </tr>
                                            </thead>
                                            <tbody v-if="away_team">
                                                <tr v-for="(player, index) in away_team.roster">
                                                    <td class="text-center">{{index+1}}</td>
                                                    <td> {{player.name}}
                                                    </td>
                                                    <td class="text-center small">0</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div>
                <sofive-footer />
            </div>

        </div>

        <div class="modal inmodal" id="myModal" tabindex="-1" role="dialog" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content animated bounceInRight">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <i class="fa fa-address-card-o modal-icon"></i>
                        <h4 class="modal-title">Rate your match referee</h4>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label>Rating:
                                <!-- <b style="font-size: 15px">{{ref_rating}}/10</b> --></label><br />
                            <button class="btn btn-warning btn-circle" type="button" v-for="i in ref_rating" style="margin-right: 5px">
                                <i class="fa fa-star"></i>
                            </button>
                            <button class="btn btn-warning btn-circle btn-outline" type="button" v-for="i in (10-ref_rating)" style="margin-right: 5px">
                                <i class="fa fa-star"></i>
                            </button>
                            <br /><br />
                            <label>Comment (optional)</label>
                            <input placeholder="Enter your comment..." class="form-control">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-white" data-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary">Save changes</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Mainly scripts -->
        <script src="js/jquery-3.1.1.min.js"></script>
        <script src="js/popper.min.js"></script>
        <script src="js/bootstrap.js"></script>
        <script src="js/plugins/metisMenu/jquery.metisMenu.js"></script>
        <script src="js/plugins/slimscroll/jquery.slimscroll.min.js"></script>

        <!-- Custom and plugin javascript -->
        <script src="js/inspinia.js"></script>

        <script src="https://cdn.jsdelivr.net/npm/vue"></script>

        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/vue-resource/1.5.1/vue-resource.min.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>

        <script type="text/javascript" src="js/navigation.js"></script>
        <script type="text/javascript" src="js/header.js"></script>
        <script type="text/javascript" src="js/footer.js"></script>
        <script type="text/javascript" src="js/standings.js"></script>

        <script type="text/javascript">
            var app = new Vue({
                el: '#wrapper',
                data: {
                    match: {
                        home: {},
                        away: {}
                    },
                    facility: {},
                    season: {},
                    league: {},
                    leaderboard: [],
                    matchID: "",
                    referee: "",
                    events: [],
                    videos: [],
                    home_team: {},
                    away_team: {},
                    ref_rating: 0
                },
                mounted: function() {
                    const params = this.findGetParameter()
                    this.matchID = params.id
                    this.getDashMatch()
                },
                methods: {
                    findGetParameter: function() {
                        var queryDict = {}
                        decodeURI(location.search).substr(1).split("&").forEach(function(item) {
                            queryDict[item.split("=")[0]] = item.split("=")[1]
                        })
                        return queryDict
                    },
                    getDashMatch: function() {
                        let url = "http://localhost:8080/match/" + this.matchID
                        this.$http.get(url)
                            .then((resp) => {
                                this.match = resp.body
                                this.getTeamsDetails(this.match.home.team_id, this.match.away.team_id)
                                this.getLeagueDetails(this.match.league_id)
                                this.getResults(this.match.league_id)
                                this.getMatchDetails()
                            })
                            .catch((err) => {
                                console.log(err)
                            })
                    },
                    getLeagueDetails: function(league_id) {
                        let url = "http://localhost:8080/league/" + league_id
                        this.$http.get(url)
                            .then((resp) => {
                                this.facility = resp.body.facility
                                this.season = resp.body.season
                                this.league = resp.body.league
                            })
                            .catch((err) => {
                                console.log(err)
                            })
                    },
                    getMatchDetails: function() {
                        let url = "https://app.scoreplay.io/match?id=" + this.matchID //29845" // TODO: replace with this.matchID
                        this.$http.get(url)
                            .then((resp) => {
                                this.referee = resp.body.ref
                                this.setupEvents(resp.body.events)
                                this.videos = resp.body.videos.map(v => ({
                                    ...v,
                                    embed: "https://www.dailymotion.com/embed/video/" + v.id + "?queue-enable=false&queue-autoplay-next=false&ui-start-screen-info=false"
                                }))
                            })
                            .catch((err) => {
                                console.log(err)
                            })
                    },
                    getTeamsDetails: function(home_id, away_id) {
                        Promise.all([this.getTeamDetails(home_id, true), this.getTeamDetails(away_id, false)])
                    },
                    getTeamDetails: function(id, home) {
                        let url = "http://localhost:8080/team/" + id
                        this.$http.get(url)
                            .then((resp) => {
                                if (home) {
                                    this.home_team = resp.body
                                } else {
                                    this.away_team = resp.body
                                }
                            })
                            .catch((err) => {
                                console.log(err)
                            })
                    },
                    getResults: function(league_id) {
                        let url = "http://localhost:8080/league/" + league_id + "/scores"
                        this.$http.get(url)
                            .then((resp) => {
                                this.leaderboard = resp.body.leaderboard
                            })
                            .catch((err) => {
                                console.log(err.body.errors)
                            })
                    },
                    setupEvents: function(events) {
                        if (events.length === 0) {
                            return
                        }
                        const home = this.match.home.name,
                            away = this.match.away.name,
                            match_start = moment(events[0].date, "YYYY-MM-DD HH:mm:ss");
                        let final_events = [],
                            home_score = 0,
                            away_score = 0;
                        events.forEach((ev) => {
                            if (ev.type === "goal") {
                                if (ev.details.side === "home") {
                                    home_score += 1
                                } else {
                                    away_score += 1
                                }
                                final_events.push({
                                    side: ev.details.side === "home" ? home : away,
                                    type: "goal",
                                    date: moment.duration(moment(ev.date, "YYYY-MM-DD HH:mm:ss").diff(match_start)).get("minutes") + "\"",
                                    subtitle: home + " <b>" + home_score + " - " + away_score + "</b> " + away
                                })
                            } else {
                                let tp = ev.type
                                if (tp !== "fouls") {
                                    final_events.push({
                                        side: ev.details.side === "home" ? home : away,
                                        type: tp,
                                        date: moment.duration(moment(ev.date, "YYYY-MM-DD HH:mm:ss").diff(match_start)).get("minutes") + "\"",
                                        subtitle: home + " <b>" + home_score + " - " + away_score + "</b> " + away
                                    })
                                }
                            }
                        })
                        this.events = final_events
                    },
                    gotoTeam: function(id) {
                        window.location = "team.html?id=" + id
                    },
                    gotoLeague: function(league_id) {
                        window.location = "league.html?id=" + league_id
                    }
                }
            })
        </script>

</body>

</html>