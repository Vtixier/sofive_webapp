<!DOCTYPE html>
<html>

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Sofive Soccer Center</title>

    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="font-awesome/css/font-awesome.css" rel="stylesheet">
    <link href="css/animate.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
    <link rel="icon" href="https://sofive.com/wp-content/uploads/2018/04/cropped-sigle-32x32.png" sizes="32x32" />
    <link rel="icon" href="https://sofive.com/wp-content/uploads/2018/04/cropped-sigle-192x192.png" sizes="192x192" />
    <link href="css/plugins/nouslider/jquery.nouislider.css" rel="stylesheet">

</head>

<body class="mini-navbar">

    <div id="wrapper">

        <div>
            <sofive-left-menu />
        </div>

        <div id="page-wrapper" class="gray-bg">

            <div>
                <sofive-header />
            </div>


            <div class="wrapper wrapper-content animated fadeInRight">
                <div class="ibox-title">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item">
                            <a href="index.html">{{info.season}}</a>
                        </li>
                        <li class="breadcrumb-item">
                            <a>{{info.league}}</a>
                        </li>
                        <li class="breadcrumb-item active" v-if="info">
                            <strong>{{info.home.name}} - {{info.away.name}}</strong>
                        </li>
                    </ol>
                </div>
                <div class="row">
                    <div class="col-lg-12">
                        <div class="ibox ">
                            <div class="ibox-content text-center p-md">
                                <div class="row">
                                    <div class="col-sm" v-if="info">
                                        <a style="font-size: 40px" class="text-center"><strong> <span style="color: #295182"> {{info.home.name}}</span> <span style="color: #4c4949"> {{info.home.score}} - {{info.away.score}} </span> <span style="color: #75acda"> {{info.away.name}} </strong></a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row animated fadeInRight">
                    <div class="col-lg-4">
                        <div class="ibox ">
                            <div class="ibox-title">
                                <h5>Replay</h5>
                            </div>
                            <div>
                                <div class="ibox-content no-padding border-left-right">
                                    <figure v-for="video in videos">
                                        <iframe width="420" height="270" allow="autoplay" :src="video.embed" frameborder="0" allowfullscreen></iframe>
                                    </figure>
                                </div>
                                <div class="ibox-content profile-content">
                                    <h4 v-if="info"><strong>{{info.home.name}} {{info.home.score}} - {{info.away.score}} {{info.away.name}}</strong></h4>
                                    <p />
                                    <p><i class="fa fa-map-marker"></i> {{info.center}}</p>
                                    <p><i class="fa fa-male"></i> {{referee.firstname+" "+referee.lastname}}</p>
                                    <div class="user-button">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <button type="button" class="btn btn-primary btn-sm btn-success"><i class="fa fa-facebook-square"></i> Share on Facebook</button>
                                            </div>
                                            <div class="col-md-6">
                                                <button type="button" class="btn btn-primary btn-sm btn-block" data-toggle="modal" data-target="#myModal">
                                                    <i class="fa fa-pencil"></i> Referee assessment
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <br />
                                <div class="ibox-content profile-content" v-if="info">
                                    <h4><strong>Next match:</strong></h4>
                                    <p />
                                    <p><i class="fa fa-calendar"></i> <i>{{info.home.name}}</i> vs. {{info.home.name}} on <b>12/05/2019</b></p>
                                    <p><i class="fa fa-calendar"></i> {{info.away.name}} vs. <i>{{info.away.name}}</i> on <b>12/05/2019</b></p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-8">
                        <div class="ibox ">
                            <div class="ibox-title">
                                <h5>Live</h5>
                                <div class="ibox-tools">
                                    <a class="collapse-link">
                                        <i class="fa fa-chevron-up"></i>
                                    </a>
                                    <a class="close-link">
                                        <i class="fa fa-times"></i>
                                    </a>
                                </div>
                            </div>
                            <div class="ibox-content" style="height: 76vh; overflow: scroll;">
                                <div class="scroll_content">

                                    <div id="vertical-timeline" class="vertical-container dark-timeline">

                                        <div class="vertical-timeline-block" v-for="event in events">
                                            <div class="vertical-timeline-icon navy-bg">
                                                <i class="fa fa-soccer-ball-o" v-if="event.type == 'goal'"></i>
                                                <i class="fa fa-meh-o" v-if="event.type == 'foul'"></i>
                                                <img src="img/sofive/yellow_card.ico" style="margin-top: 10%" v-if="event.type == 'yellow_card'" />
                                                <img src="img/sofive/red_card.ico" style="margin-top: 10%" v-if="event.type == 'red_card'" />
                                            </div>

                                            <div class="vertical-timeline-content">
                                                <!-- <a href="#" class="btn btn-sm btn-primary">Video</a> -->
                                                <h2 style="color: #295182">{{event.side}} <b>{{event.type}}</b></h2>
                                                <span class="vertical-date">
                                                    <div v-html="event.subtitle" /><br />
                                                    <small>{{event.side}}</small>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-lg-4 col-sm-12">
                    <div class="ibox ">
                        <div class="ibox-title">
                            <h5>Standings</h5>
                            <div class="ibox-tools">
                                <a class="collapse-link">
                                    <i class="fa fa-chevron-up"></i>
                                </a>
                                <a class="close-link">
                                    <i class="fa fa-times"></i>
                                </a>
                            </div>
                        </div>
                        <div class="ibox-content">
                            <div>
                                <table class="table table-hover margin bottom">
                                    <thead>
                                        <tr>
                                            <th style="width: 1%" class="text-center">No.</th>
                                            <th>Team</th>
                                            <th class="text-center">Games</th>
                                            <th class="text-center">Points</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr v-for="(standing, index) in info.standings">
                                            <td class="text-center">{{index+1}}</td>
                                            <td>
                                                <span class="text-navy" v-if="standing.Team == info.home.name">{{standing.Team}}</span>
                                                <span class="text-navy" v-if="standing.Team == info.away.name">{{standing.Team}}</span>
                                                <span v-if="(standing.Team !== info.home.name) && (standing.Team !== info.away.name)">{{standing.Team}}</span>
                                            </td>
                                            <td class="text-center">{{standing.Games}}</td>
                                            <td class="text-center"><span>{{standing.Points}}</span></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>


                        </div>
                    </div>
                </div>
                <div class="col-lg-8 col-sm-12">
                    <div class="ibox ">
                        <div class="ibox-title">
                            <h5>Roasters</h5>
                            <div class="ibox-tools">
                                <a class="collapse-link">
                                    <i class="fa fa-chevron-up"></i>
                                </a>
                                <a class="close-link">
                                    <i class="fa fa-times"></i>
                                </a>
                            </div>
                        </div>
                        <div class="ibox-content">

                            <div class="row">
                                <div class="col-lg-6">
                                    <table class="table table-hover margin bottom">
                                        <thead>
                                            <tr>
                                                <th style="width: 1%" class="text-center">No.</th>
                                                <th>Players</th>
                                                <th class="text-center">Goals</th>
                                                <th class="text-center">More info</th>
                                            </tr>
                                        </thead>
                                        <tbody v-if="home_team">
                                            <tr v-for="(player, index) in home_team.roster">
                                                <td class="text-center">{{index+1}}</td>
                                                <td> {{player.name}}
                                                </td>
                                                <td class="text-center small">0</td>
                                                <td style="text-align: center"><a href="#"><span class="label label-primary">card</span></a></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="col-lg-6">
                                    <table class="table table-hover margin bottom">
                                        <thead>
                                            <tr>
                                                <th style="width: 1%" class="text-center">No.</th>
                                                <th>Player</th>
                                                <th class="text-center">Goals</th>
                                                <th class="text-center">More info</th>
                                            </tr>
                                        </thead>
                                        <tbody v-if="away_team">
                                            <tr v-for="(player, index) in away_team.roster">
                                                <td class="text-center">{{index+1}}</td>
                                                <td> {{player.name}}
                                                </td>
                                                <td class="text-center small">0</td>
                                                <td style="text-align: center"><a href="#"><span class="label label-primary">card</span></a></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal inmodal" id="myModal" tabindex="-1" role="dialog" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content animated bounceInRight">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <i class="fa fa-address-card-o modal-icon"></i>
                        <h4 class="modal-title">Rate your match referee</h4>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label>Rating: <b style="font-size: 15px">{{ref_rating}}/10</b></label>
                            <div id="basic_slider"></div>
                            <br />
                            <label>Comment (optional)</label>
                            <input placeholder="Enter your comment..." class="form-control">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-white" data-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary">Save changes</button>
                    </div>
                </div>
            </div>
        </div>

        <div>
            <sofive-footer />
        </div>

        <!-- Mainly scripts -->
        <script src="js/jquery-3.1.1.min.js"></script>
        <script src="js/popper.min.js"></script>
        <script src="js/bootstrap.js"></script>
        <script src="js/plugins/metisMenu/jquery.metisMenu.js"></script>
        <script src="js/plugins/slimscroll/jquery.slimscroll.min.js"></script>
        <script src="js/plugins/nouslider/jquery.nouislider.min.js"></script>

        <!-- Custom and plugin javascript -->
        <script src="js/inspinia.js"></script>

        <script src="https://cdn.jsdelivr.net/npm/vue"></script>

        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/vue-resource/1.5.1/vue-resource.min.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>

        <script type="text/javascript" src="js/navigation.js"></script>
        <script type="text/javascript" src="js/header.js"></script>
        <script type="text/javascript" src="js/footer.js"></script>

        <script type="text/javascript">
            var app = new Vue({
                el: '#wrapper',
                data: {
                    info: "",
                    matchID: "",
                    referee: "",
                    events: [],
                    videos: [],
                    home_team: {},
                    away_team: {},
                    ref_rating: 7
                },
                mounted: function() {

                    const self = this;

                    $(document).ready(function() {
                        var basic_slider = document.getElementById('basic_slider');
                        noUiSlider.create(basic_slider, {
                            start: 7,
                            behaviour: 'tap',
                            connect: 'lower',
                            range: {
                                'min': 0,
                                'max': 10
                            },
                            step: 1
                        });
                        basic_slider.noUiSlider.on('update.one', function(a) {
                            self.ref_rating = parseInt(a[0])
                        });
                    })

                    const params = this.findGetParameter(),
                        origin = params.origin || "";
                    if (origin !== "") {
                        this.info = JSON.parse(atob(origin))
                        this.getTeamsDetails(this.info.home.id, this.info.away.id)
                    }
                    this.matchID = params.id
                    this.getMatchDetails()
                },
                methods: {
                    findGetParameter: function() {
                        var queryDict = {}
                        decodeURI(location.search).substr(1).split("&").forEach(function(item) {
                            queryDict[item.split("=")[0]] = item.split("=")[1]
                        })
                        return queryDict
                    },
                    getMatchDetails: function() {
                        let url = "https://app.scoreplay.io/match?id=29845" // TODO: replace with this.matchID
                        this.$http.get(url)
                            .then((resp) => {
                                this.referee = resp.body.ref
                                this.setupEvents(resp.body.events)
                                this.videos = resp.body.videos.map(v => ({
                                    ...v,
                                    embed: "https://www.dailymotion.com/embed/video/" + v.id + "?start=0"
                                }))
                            })
                            .catch((err) => {
                                console.log(err)
                            })
                    },
                    setupEvents: function(events) {
                        const home = this.info.home.name,
                            away = this.info.away.name;
                        let final_events = [],
                            home_score = 0,
                            away_score = 0;
                        events.forEach((ev) => {
                            if (ev.type === "goal") {
                                if (ev.details.side === "home") {
                                    home_score += 1
                                } else {
                                    away_score += 1
                                }
                                final_events.push({
                                    side: ev.details.side === "home" ? home : away,
                                    type: "goal",
                                    date: ev.date,
                                    subtitle: home + " <b>" + home_score + " - " + away_score + "</b> " + away
                                })
                            } else {
                                let tp = ev.type
                                if (tp !== "fouls") {
                                    final_events.push({
                                        side: ev.details.side === "home" ? home : away,
                                        type: tp,
                                        date: ev.date,
                                        subtitle: home + " <b>" + home_score + " - " + away_score + "</b> " + away
                                    })
                                }
                            }
                        })
                        this.events = final_events
                    },
                    getTeamsDetails: function(home_id, away_id) {
                        Promise.all([this.getTeamDetails(home_id, true), this.getTeamDetails(away_id, false)])
                    },
                    getTeamDetails: function(id, home) {
                        let url = "http://localhost:8080/team/" + id
                        this.$http.get(url)
                            .then((resp) => {
                                if (home) {
                                    this.home_team = resp.body
                                } else {
                                    this.away_team = resp.body
                                }
                            })
                            .catch((err) => {
                                console.log(err)
                            })
                    }
                }
            })
        </script>

</body>

</html>